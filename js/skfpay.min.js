var popup;
var confirmationPoller;

window.addEventListener("message", receiveMessage, false);

function startConfirmationPolling() {
  confirmationPoller = setInterval(function(){
    sendMessage({"request":"getPaymentStatus"});
  }, 1000);
}

function sendMessage(message) {
  popup.postMessage(message, "https://www.skfpay.com");
}

function receiveMessage(event) {
  if(event.origin !== "https://www.skfpay.com") {
    return;
  }
  if(typeof event.data === "object") {
    if(event.data.hasOwnProperty("success") && event.data.hasOwnProperty("response")) {
      if(event.data.success) {
        popup.close();
        clearInterval(confirmationPoller);
        window.location.href = 'https://tuz1k.com/process/skf.php?paymentId='+event.data.response;
      }
    }
  }
}

$(".addFunds").click(function() {
  popup = window.open("https://www.skfpay.com/widget/payment/#3439363537363a313a7b64623131343966362d663661652d346264342d393130382d6133383363333830616332377d", "", "width=600,height=800");
  startConfirmationPolling();
});
